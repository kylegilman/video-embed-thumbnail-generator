(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.i18n,r=window.wp.element,a=window.wp.apiFetch;var n=e.n(a);const s=window.wp.components,o=window.wp.data,i=window.ReactJSXRuntime,l=e=>{if(isNaN(e)||e<0)return"--:--";const t=Math.floor(e/3600),r=Math.floor(e%3600/60),a=Math.floor(e%60),n=e=>e.toString().padStart(2,"0");return(t>0?`${t}:`:"")+`${n(r)}:${n(a)}`},d=()=>{const[e,a]=(0,r.useState)([]),[d,c]=(0,r.useState)(!0),[u,m]=(0,r.useState)("pause"===videopackEncodeQueueData.initialQueueState),[b,h]=(0,r.useState)(null),[p,_]=(0,r.useState)(!1),[g,v]=(0,r.useState)(!1),[y,j]=(0,r.useState)(null),[x,f]=(0,r.useState)(null),w=(0,r.useRef)(null),{restUrl:T,nonce:q,ffmpegExists:D}=videopackEncodeQueueData,E=((0,o.useSelect)(e=>e("core").getSite()?.language),async()=>{c(!0);try{const e=await n()({path:`${T}queue`,headers:{"X-WP-Nonce":q}});a(e);const t=e.some(e=>"processing"===e.status);t&&!w.current?w.current=setInterval(E,5e3):!t&&w.current&&(clearInterval(w.current),w.current=null)}catch(e){console.error("Error fetching queue:",e),h({type:"error",text:(0,t.sprintf)((0,t.__)("Failed to load queue: %s","video-embed-thumbnail-generator"),e.message||e.code)}),w.current&&(clearInterval(w.current),w.current=null)}finally{c(!1)}});(0,r.useEffect)(()=>(E(),()=>{w.current&&clearInterval(w.current)}),[]);const S=async e=>{if(confirm("all"===e?(0,t.__)("Are you sure you want to clear all jobs?","video-embed-thumbnail-generator"):(0,t.__)("Are you sure you want to clear completed jobs?","video-embed-thumbnail-generator"))){_(!0);try{const t=await n()({path:`${T}queue/clear`,method:"DELETE",headers:{"X-WP-Nonce":q},data:{type:e}});h({type:"success",text:t.message}),E()}catch(e){console.error("Error clearing queue:",e),h({type:"error",text:(0,t.sprintf)((0,t.__)("Failed to clear queue: %s","video-embed-thumbnail-generator"),e.message||e.code)})}finally{_(!1)}}},C=async e=>{if(confirm((0,t.__)("Are you sure you want to delete this job?","video-embed-thumbnail-generator"))){j(e);try{await n()({path:`${T}queue/${e}`,method:"DELETE",headers:{"X-WP-Nonce":q}}),h({type:"success",text:(0,t.sprintf)((0,t.__)("Job %d deleted successfully.","video-embed-thumbnail-generator"),e)}),E()}catch(r){console.error("Error deleting job:",r),h({type:"error",text:(0,t.sprintf)((0,t.__)("Failed to delete job %d: %s","video-embed-thumbnail-generator"),e,r.message||r.code)})}finally{j(null)}}},R=e=>{if("processing"===e.status&&e.progress){const r=e.progress.percent_done||0,a=l(e.progress.elapsed),n=l(e.progress.remaining),s=e.progress.fps||0;return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"videopack-progress-bar-container",children:(0,i.jsx)("div",{className:"videopack-progress-bar",style:{width:`${r}%`},children:r>5&&`${r}%`})}),(0,i.jsxs)("small",{children:[(0,t.sprintf)((0,t.__)("Elapsed: %s","video-embed-thumbnail-generator"),a)," |"," ",(0,t.sprintf)((0,t.__)("Remaining: %s","video-embed-thumbnail-generator"),n)," |"," ",(0,t.sprintf)((0,t.__)("FPS: %s","video-embed-thumbnail-generator"),s)]})]})}return e.status_l10n||e.status};return(0,i.jsxs)("div",{className:"wrap videopack-encode-queue",children:[(0,i.jsx)("h1",{children:(0,t.__)("Videopack Encode Queue","video-embed-thumbnail-generator")}),b&&(0,i.jsx)(s.Notice,{status:b.type,onRemove:()=>h(null),children:b.text}),(0,i.jsxs)(s.PanelBody,{children:[(0,i.jsxs)("div",{className:"videopack-queue-controls",children:[(0,i.jsxs)(s.Button,{variant:"primary",onClick:async()=>{v(!0);const e=u?"play":"pause";try{const t=await n()({path:`${T}queue/control`,method:"POST",headers:{"X-WP-Nonce":q},data:{action:e}});m("pause"===t.queue_state),h({type:"success",text:t.message}),E()}catch(e){console.error("Error toggling queue:",e),h({type:"error",text:(0,t.sprintf)((0,t.__)("Failed to toggle queue: %s","video-embed-thumbnail-generator"),e.message||e.code)})}finally{v(!1)}},isBusy:g,disabled:d||g||!D,children:[(0,i.jsx)(s.Dashicon,{icon:u?"play":"pause"}),u?(0,t.__)("Play Queue","video-embed-thumbnail-generator"):(0,t.__)("Pause Queue","video-embed-thumbnail-generator")]}),(0,i.jsx)(s.Button,{variant:"secondary",onClick:()=>S("completed"),isBusy:p,disabled:d||p||!D,children:(0,t.__)("Clear Completed","video-embed-thumbnail-generator")}),(0,i.jsx)(s.Button,{variant:"tertiary",isDestructive:!0,onClick:()=>S("all"),isBusy:p,disabled:d||p||!D,children:(0,t.__)("Clear All","video-embed-thumbnail-generator")}),d&&(0,i.jsx)(s.Spinner,{})]}),!D&&(0,i.jsx)(s.Notice,{status:"warning",isDismissible:!1,children:(0,t.__)("FFmpeg is not detected or configured. Encoding functions are disabled.","video-embed-thumbnail-generator")}),(0,i.jsx)(s.__experimentalDivider,{}),d&&0===e.length?(0,i.jsx)("p",{children:(0,t.__)("Loading queue...","video-embed-thumbnail-generator")}):0===e.length?(0,i.jsx)("p",{children:(0,t.__)("The encode queue is empty.","video-embed-thumbnail-generator")}):(0,i.jsxs)(s.Table,{className:"videopack-queue-table",children:[(0,i.jsx)(s.TableHead,{children:(0,i.jsxs)(s.TableRow,{children:[(0,i.jsx)(s.TableHeader,{children:(0,t.__)("ID","video-embed-thumbnail-generator")}),(0,i.jsx)(s.TableHeader,{children:(0,t.__)("Thumbnail","video-embed-thumbnail-generator")}),(0,i.jsx)(s.TableHeader,{children:(0,t.__)("Video Title","video-embed-thumbnail-generator")}),(0,i.jsx)(s.TableHeader,{children:(0,t.__)("Format","video-embed-thumbnail-generator")}),(0,i.jsx)(s.TableHeader,{children:(0,t.__)("Status","video-embed-thumbnail-generator")}),(0,i.jsx)(s.TableHeader,{children:(0,t.__)("Actions","video-embed-thumbnail-generator")})]})}),(0,i.jsx)(s.TableBody,{children:e.map(e=>(0,i.jsxs)(s.TableRow,{children:[(0,i.jsx)(s.TableCell,{children:e.job_id}),(0,i.jsx)(s.TableCell,{children:e.poster_url&&(0,i.jsx)("img",{src:e.poster_url,alt:e.video_title,style:{maxWidth:"80px",height:"auto"}})}),(0,i.jsx)(s.TableCell,{children:e.video_title}),(0,i.jsx)(s.TableCell,{children:e.format_name}),(0,i.jsx)(s.TableCell,{children:R(e)}),(0,i.jsxs)(s.TableCell,{children:["processing"!==e.status&&"queued"!==e.status&&"pending_replacement"!==e.status&&(0,i.jsx)(s.Button,{size:"small",isDestructive:!0,onClick:()=>C(e.job_id),isBusy:y===e.job_id,children:(0,t.__)("Delete","video-embed-thumbnail-generator")}),("processing"===e.status||"queued"===e.status||"pending_replacement"===e.status)&&(0,i.jsx)(s.Button,{size:"small",isDestructive:!0,onClick:()=>C(e.job_id),isBusy:y===e.job_id,children:(0,t.__)("Cancel","video-embed-thumbnail-generator")}),"failed"===e.status&&(0,i.jsx)(s.Button,{size:"small",variant:"secondary",onClick:()=>(async e=>{f(e);try{await n()({path:`${T}queue/retry/${e}`,method:"POST",headers:{"X-WP-Nonce":q}}),h({type:"success",text:(0,t.sprintf)((0,t.__)("Job %d has been re-queued.","video-embed-thumbnail-generator"),e)}),E()}catch(r){console.error("Error retrying job:",r),h({type:"error",text:(0,t.sprintf)((0,t.__)("Failed to retry job %d: %s","video-embed-thumbnail-generator"),e,r.message||r.code)})}finally{f(null)}})(e.job_id),isBusy:x===e.job_id,children:(0,t.__)("Retry","video-embed-thumbnail-generator")})]})]},e.job_id))})]})]})]})};document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("videopack-queue-root");e&&("undefined"!=typeof ReactDOM&&ReactDOM.createRoot?ReactDOM.createRoot(e).render((0,i.jsx)(d,{})):"undefined"!=typeof ReactDOM&&ReactDOM.render?ReactDOM.render((0,i.jsx)(d,{}),e):console.error("ReactDOM is not available. Cannot render React component."))})})();