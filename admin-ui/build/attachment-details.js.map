{"version":3,"file":"attachment-details.js","mappings":"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","sources":["webpack://videopack-admin/./src/components/AdditionalFormats/AdditionalFormats.js","webpack://videopack-admin/./src/components/AdditionalFormats/EncodeFormatStatus.js","webpack://videopack-admin/./src/components/AdditionalFormats/EncodeProgress.js","webpack://videopack-admin/./src/components/Thumbnails/Thumbnails.js","webpack://videopack-admin/./src/features/attachment-details/components/AttachmentDetails.js","webpack://videopack-admin/./src/utils/utils.js","webpack://videopack-admin/./src/utils/video-capture.js","webpack://videopack-admin/./src/components/AdditionalFormats/additional-formats.scss?d4d2","webpack://videopack-admin/./src/components/Thumbnails/Thumbnails.scss?a955","webpack://videopack-admin/./src/features/attachment-details/attachment-details.scss","webpack://videopack-admin/external window \"ReactJSXRuntime\"","webpack://videopack-admin/external window [\"wp\",\"apiFetch\"]","webpack://videopack-admin/external window [\"wp\",\"components\"]","webpack://videopack-admin/external window [\"wp\",\"coreData\"]","webpack://videopack-admin/external window [\"wp\",\"data\"]","webpack://videopack-admin/external window [\"wp\",\"element\"]","webpack://videopack-admin/external window [\"wp\",\"i18n\"]","webpack://videopack-admin/external window [\"wp\",\"mediaUtils\"]","webpack://videopack-admin/external window [\"wp\",\"primitives\"]","webpack://videopack-admin/external window [\"wp\",\"url\"]","webpack://videopack-admin/./node_modules/@wordpress/icons/build-module/library/chevron-down.mjs","webpack://videopack-admin/./node_modules/@wordpress/icons/build-module/library/chevron-up.mjs","webpack://videopack-admin/webpack/bootstrap","webpack://videopack-admin/webpack/runtime/compat get default export","webpack://videopack-admin/webpack/runtime/define property getters","webpack://videopack-admin/webpack/runtime/hasOwnProperty shorthand","webpack://videopack-admin/webpack/runtime/make namespace object","webpack://videopack-admin/./src/features/attachment-details/attachment-details.js"],"sourcesContent":["/* global videopack_config */\n\nimport { __, sprintf } from '@wordpress/i18n';\nimport {\n\tButton,\n\tPanelBody,\n\tPanelRow,\n\tSpinner,\n\t__experimentalConfirmDialog as ConfirmDialog,\n} from '@wordpress/components';\nimport { useRef, useEffect, useState } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport { store as coreStore } from '@wordpress/core-data';\nimport './additional-formats.scss';\nimport EncodeFormatStatus from './EncodeFormatStatus';\nimport {\n\tgetVideoFormats,\n\tenqueueJob,\n\tassignFormat,\n\tdeleteFile,\n\tdeleteJob,\n} from '../../utils/utils';\n\nconst AdditionalFormats = ({ attributes, options = {} }) => {\n\tconst { id, src } = attributes;\n\tconst { ffmpeg_exists } = options;\n\tconst [videoFormats, setVideoFormats] = useState({});\n\tconst [encodeMessage, setEncodeMessage] = useState();\n\tconst [itemToDelete, setItemToDelete] = useState(null); // { type: 'file'/'job', formatId: string, jobId?: int, id?: int, name?: string }\n\tconst [deleteInProgress, setDeleteInProgress] = useState(null); // Stores formatId or jobId being deleted\n\tconst [isConfirmOpen, setIsConfirmOpen] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst [isEncoding, setIsEncoding] = useState(false);\n\tconst progressTimerRef = useRef(null);\n\n\tconst updateVideoFormats = (response) => {\n\t\tsetVideoFormats((currentVideoFormats) => {\n\t\t\tif (response && typeof response === 'object') {\n\t\t\t\tconst newFormats = { ...response };\n\t\t\t\tObject.keys(newFormats).forEach((key) => {\n\t\t\t\t\tconst newFormat = newFormats[key];\n\t\t\t\t\tconst oldFormat = currentVideoFormats?.[key];\n\n\t\t\t\t\t// Preserve the existing 'checked' state to prevent UI flicker on poll refresh.\n\t\t\t\t\tnewFormat.checked = oldFormat?.checked || false;\n\n\t\t\t\t\t// If the format is encoding, merge progress data carefully.\n\t\t\t\t\tif (newFormat.encoding_now && newFormat.progress) {\n\t\t\t\t\t\t// If there's old progress data, merge it to prevent flashes of 0%.\n\t\t\t\t\t\tif (oldFormat?.progress) {\n\t\t\t\t\t\t\tnewFormat.progress = {\n\t\t\t\t\t\t\t\t...oldFormat.progress,\n\t\t\t\t\t\t\t\t...newFormat.progress,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// If no old progress, ensure we don't start with a negative percent.\n\t\t\t\t\t\t\tnewFormat.progress.percent =\n\t\t\t\t\t\t\t\tnewFormat.progress.percent > 0\n\t\t\t\t\t\t\t\t\t? newFormat.progress.percent\n\t\t\t\t\t\t\t\t\t: 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Only update state if the formats have actually changed.\n\t\t\t\tif (\n\t\t\t\t\tJSON.stringify(currentVideoFormats) !==\n\t\t\t\t\tJSON.stringify(newFormats)\n\t\t\t\t) {\n\t\t\t\t\treturn newFormats;\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\tJSON.stringify(currentVideoFormats) !== JSON.stringify(response)\n\t\t\t) {\n\t\t\t\t// Fallback for non-object responses\n\t\t\t\treturn response;\n\t\t\t}\n\t\t\treturn currentVideoFormats;\n\t\t});\n\t};\n\n\tconst fetchVideoFormats = async () => {\n\t\tif (!id) {\n\t\t\treturn;\n\t\t} // Don't fetch if there's no ID.\n\t\ttry {\n\t\t\tconst formats = await getVideoFormats(id);\n\t\t\tupdateVideoFormats(formats);\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching video formats:', error);\n\t\t}\n\t};\n\n\tconst pollVideoFormats = async () => {\n\t\tif (src && id) {\n\t\t\ttry {\n\t\t\t\tconst formats = await getVideoFormats(id);\n\t\t\t\tupdateVideoFormats(formats);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error polling video formats:', error);\n\t\t\t}\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tfetchVideoFormats();\n\t}, [id]); // Fetch formats when the attachment ID changes\n\n\tconst siteSettings = useSelect((select) => {\n\t\treturn select('core').getSite();\n\t}, []);\n\n\tconst shouldPoll = (formats) => {\n\t\tif (!formats) {\n\t\t\treturn false;\n\t\t}\n\t\t// Poll only if at least one format is still in a state that requires updates.\n\t\treturn Object.values(formats).some(\n\t\t\t(format) =>\n\t\t\t\tformat.status === 'queued' ||\n\t\t\t\tformat.status === 'encoding' ||\n\t\t\t\tformat.status === 'processing' ||\n\t\t\t\tformat.status === 'needs_insert'\n\t\t);\n\t};\n\n\tconst incrementEncodeProgress = () => {\n\t\tsetVideoFormats((currentVideoFormats) => {\n\t\t\tif (!currentVideoFormats || !isEncoding) {\n\t\t\t\treturn currentVideoFormats;\n\t\t\t}\n\n\t\t\tconst updatedVideoFormats = { ...currentVideoFormats };\n\t\t\tObject.keys(updatedVideoFormats).forEach((key) => {\n\t\t\t\tconst format = updatedVideoFormats[key];\n\t\t\t\tif (format.encoding_now && format.progress) {\n\t\t\t\t\tconst elapsed =\n\t\t\t\t\t\tnew Date().getTime() / 1000 - format.started;\n\t\t\t\t\tlet percent = format.progress.percent || 0;\n\t\t\t\t\tlet remaining = null;\n\n\t\t\t\t\t// Only calculate remaining time if video_duration is available.\n\t\t\t\t\tif (format.video_duration) {\n\t\t\t\t\t\tconst totalDurationInSeconds =\n\t\t\t\t\t\t\tformat.video_duration / 1000000;\n\t\t\t\t\t\tconst speedMatch = format.progress.speed\n\t\t\t\t\t\t\t? String(format.progress.speed).match(/(\\d*\\.?\\d+)/)\n\t\t\t\t\t\t\t: null;\n\t\t\t\t\t\tconst speed = speedMatch\n\t\t\t\t\t\t\t? parseFloat(speedMatch[0])\n\t\t\t\t\t\t\t: 0;\n\n\t\t\t\t\t\t// Increment percent based on speed. This function runs every second.\n\t\t\t\t\t\tif (speed > 0) {\n\t\t\t\t\t\t\tconst increment =\n\t\t\t\t\t\t\t\t(1 / totalDurationInSeconds) * 100 * speed;\n\t\t\t\t\t\t\tpercent += increment;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Calculate remaining time based on current percent and speed\n\t\t\t\t\t\tif (percent > 0 && speed > 0) {\n\t\t\t\t\t\t\tconst remainingPercent = 100 - percent;\n\t\t\t\t\t\t\tremaining =\n\t\t\t\t\t\t\t\t(totalDurationInSeconds *\n\t\t\t\t\t\t\t\t\t(remainingPercent / 100)) /\n\t\t\t\t\t\t\t\tspeed;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tremaining = totalDurationInSeconds - elapsed;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Clamp values to be within expected ranges.\n\t\t\t\t\tpercent = Math.min(100, Math.max(0, percent));\n\t\t\t\t\tremaining =\n\t\t\t\t\t\tremaining !== null ? Math.max(0, remaining) : null;\n\n\t\t\t\t\tupdatedVideoFormats[key] = {\n\t\t\t\t\t\t...format,\n\t\t\t\t\t\tprogress: {\n\t\t\t\t\t\t\t...format.progress,\n\t\t\t\t\t\t\telapsed,\n\t\t\t\t\t\t\tremaining,\n\t\t\t\t\t\t\tpercent,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn updatedVideoFormats;\n\t\t});\n\t};\n\n\tuseEffect(() => {\n\t\tsetIsEncoding(shouldPoll(videoFormats));\n\t}, [videoFormats]);\n\n\tuseEffect(() => {\n\t\tlet pollTimer = null;\n\t\t// Manage progress timer based on encoding state\n\t\tif (isEncoding) {\n\t\t\t// Start polling immediately and then every 5 seconds\n\t\t\tpollVideoFormats(); // Initial poll\n\t\t\tpollTimer = setInterval(pollVideoFormats, 5000);\n\n\t\t\tif (progressTimerRef.current === null) {\n\t\t\t\tprogressTimerRef.current = setInterval(\n\t\t\t\t\tincrementEncodeProgress,\n\t\t\t\t\t1000\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\t// Clear all timers if not encoding\n\t\t\tclearInterval(progressTimerRef.current);\n\t\t\tprogressTimerRef.current = null;\n\t\t\tclearInterval(pollTimer);\n\t\t\tpollTimer = null;\n\t\t}\n\n\t\treturn () => {\n\t\t\tif (progressTimerRef.current !== null) {\n\t\t\t\tclearInterval(progressTimerRef.current);\n\t\t\t\tprogressTimerRef.current = null;\n\t\t\t}\n\t\t\tif (pollTimer !== null) {\n\t\t\t\tclearInterval(pollTimer);\n\t\t\t\tpollTimer = null;\n\t\t\t}\n\t\t};\n\t}, [isEncoding]); // Depend on isEncoding state\n\n\tconst handleFormatCheckbox = (event, formatId) => {\n\t\tsetVideoFormats((prevVideoFormats) => {\n\t\t\tconst updatedFormats = { ...prevVideoFormats };\n\t\t\tif (updatedFormats[formatId]) {\n\t\t\t\tupdatedFormats[formatId].checked = event;\n\t\t\t}\n\t\t\treturn updatedFormats;\n\t\t});\n\t\t// Note: Checkbox state is now purely UI. Saving to DB happens on \"Encode\" button click.\n\t};\n\n\tconst handleEnqueue = async () => {\n\t\tif (!videopack_config) {\n\t\t\treturn <Spinner />;\n\t\t}\n\n\t\tsetIsLoading(true);\n\n\t\t// Get list of format IDs that are checked and available\n\t\tconst formatsToEncode = Object.entries(videoFormats)\n\t\t\t.filter(\n\t\t\t\t([key, value]) =>\n\t\t\t\t\tvalue.checked &&\n\t\t\t\t\tvalue.status !== 'queued' &&\n\t\t\t\t\tvalue.status !== 'processing' &&\n\t\t\t\t\tvalue.status !== 'completed'\n\t\t\t)\n\t\t\t.reduce((acc, [key, value]) => {\n\t\t\t\tacc[key] = true; // Backend expects an object { format_id: true, ... }\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\n\t\ttry {\n\t\t\tconst response = await enqueueJob(id, src, formatsToEncode);\n\t\t\tconst queueMessage = () => {\n\t\t\t\tconst queueList = (() => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tresponse?.encode_list &&\n\t\t\t\t\t\tArray.isArray(response.encode_list) &&\n\t\t\t\t\t\tresponse.encode_list.length > 0\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn new Intl.ListFormat(\n\t\t\t\t\t\t\tsiteSettings?.language\n\t\t\t\t\t\t\t\t? siteSettings.language.replace('_', '-')\n\t\t\t\t\t\t\t\t: 'en-US',\n\t\t\t\t\t\t\t{ style: 'long', type: 'conjunction' }\n\t\t\t\t\t\t).format(response.encode_list);\n\t\t\t\t\t}\n\t\t\t\t\treturn '';\n\t\t\t\t})();\n\n\t\t\t\tif (!queueList) {\n\t\t\t\t\tif (response?.log?.length > 0) {\n\t\t\t\t\t\treturn response.log.join(' ');\n\t\t\t\t\t}\n\t\t\t\t\treturn __( 'No formats were added to the queue.', 'video-embed-thumbnail-generator' );\n\t\t\t\t}\n\n\t\t\t\tconst queuePosition = response?.new_queue_position;\n\n\t\t\t\treturn sprintf(\n\t\t\t\t\t/* translators: %1$s is a list of video formats. %2$s is a number */\n\t\t\t\t\t__( '%1$s added to queue in position %2$s.', 'video-embed-thumbnail-generator' ),\n\t\t\t\t\tqueueList,\n\t\t\t\t\tqueuePosition\n\t\t\t\t);\n\t\t\t};\n\t\t\tsetEncodeMessage(queueMessage());\n\t\t\tfetchVideoFormats(); // Re-fetch to update statuses\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t\t// Use the detailed error messages from the server if available\n\t\t\tconst errorMessage = error?.data?.details\n\t\t\t\t? error.data.details.join(', ')\n\t\t\t\t: error.message;\n\t\t\t/* translators: %s is an error message */\n\t\t\tsetEncodeMessage(sprintf(__( 'Error: %s', 'video-embed-thumbnail-generator' ), errorMessage));\n\t\t\tfetchVideoFormats(); // Re-fetch to ensure UI is consistent\n\t\t} finally {\n\t\t\tsetIsLoading(false);\n\t\t}\n\t};\n\n\tconst onSelectFormat = (formatId) => async (media) => {\n\t\tif (!media || !media.id || !formatId) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsLoading(true);\n\n\t\ttry {\n\t\t\tawait assignFormat(media.id, formatId, id);\n\t\t\tsetEncodeMessage(__( 'Video format assigned successfully.', 'video-embed-thumbnail-generator' ));\n\t\t\tfetchVideoFormats(); // Refresh the list\n\t\t} catch (error) {\n\t\t\tconsole.error('Error assigning video format:', error);\n\t\t\tsetEncodeMessage(\n\t\t\t\tsprintf(\n\t\t\t\t\t/* translators: %s is an error message */\n\t\t\t\t\t__( 'Error: %s', 'video-embed-thumbnail-generator' ),\n\t\t\t\t\terror.message\n\t\t\t\t)\n\t\t\t);\n\t\t} finally {\n\t\t\tsetIsLoading(false);\n\t\t}\n\t};\n\n\t// Deletes the actual media file (WP Attachment)\n\tconst handleFileDelete = async (formatId) => {\n\t\tconst formatData = videoFormats?.[formatId];\n\t\tif (!formatData || !formatData.id) {\n\t\t\tsetEncodeMessage(\n\t\t\t\t__( 'Error: Cannot delete file, missing attachment ID.', 'video-embed-thumbnail-generator' )\n\t\t\t);\n\t\t\tconsole.error(\n\t\t\t\t'Cannot delete file: Missing id for format',\n\t\t\t\tformatId\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tsetDeleteInProgress(formatId); // Mark this formatId as being deleted\n\t\ttry {\n\t\t\tawait deleteFile(formatData.id);\n\t\t\tsetEncodeMessage(__( 'File deleted successfully.', 'video-embed-thumbnail-generator' ));\n\t\t\tfetchVideoFormats(); // Re-fetch to get the latest status from backend\n\t\t} catch (error) {\n\t\t\tconsole.error('File delete failed:', error);\n\t\t\tsetEncodeMessage(\n\t\t\t\t/* translators: %s is an error message */\n\t\t\t\tsprintf(__( 'Error deleting file: %s', 'video-embed-thumbnail-generator' ), error.message)\n\t\t\t);\n\t\t\tfetchVideoFormats(); // Re-fetch to get the latest status\n\t\t} finally {\n\t\t\tsetDeleteInProgress(null);\n\t\t}\n\t};\n\n\t// Deletes/Cancels a queue job\n\tconst handleJobDelete = async (jobId) => {\n\t\tif (!jobId) {\n\t\t\tsetEncodeMessage(__( 'Error: Cannot delete job, missing job ID.', 'video-embed-thumbnail-generator' ));\n\t\t\tconsole.error('Cannot delete job: Missing job ID');\n\t\t\treturn;\n\t\t}\n\t\tsetDeleteInProgress(jobId); // Mark this jobId as being deleted\n\t\ttry {\n\t\t\tawait deleteJob(jobId);\n\t\t\tsetEncodeMessage(__( 'Job cancelled/deleted successfully.', 'video-embed-thumbnail-generator' ));\n\t\t\tfetchVideoFormats(); // Re-fetch to get the latest status\n\t\t} catch (error) {\n\t\t\tconsole.error('Job delete failed:', error);\n\t\t\tsetEncodeMessage(\n\t\t\t\t/* translators: %s is an error message */\n\t\t\t\tsprintf(__( 'Error deleting job: %s', 'video-embed-thumbnail-generator' ), error.message)\n\t\t\t);\n\t\t\tfetchVideoFormats(); // Re-fetch to get the latest status\n\t\t} finally {\n\t\t\tsetDeleteInProgress(null);\n\t\t}\n\t};\n\n\tconst openConfirmDialog = (type, formatId) => {\n\t\tconst formatData = videoFormats?.[formatId];\n\t\tif (!formatData) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetItemToDelete({\n\t\t\ttype, // 'file' or 'job'\n\t\t\tformatId,\n\t\t\tjobId: formatData.job_id,\n\t\t\tid: formatData.id,\n\t\t\tname: formatData.name,\n\t\t});\n\t\tsetIsConfirmOpen(true);\n\t};\n\n\tconst handleConfirm = () => {\n\t\tsetIsConfirmOpen(false);\n\t\tif (itemToDelete) {\n\t\t\tif (itemToDelete.type === 'file' && itemToDelete.id) {\n\t\t\t\thandleFileDelete(itemToDelete.formatId);\n\t\t\t} else if (itemToDelete.type === 'job' && itemToDelete.jobId) {\n\t\t\t\thandleJobDelete(itemToDelete.jobId);\n\t\t\t}\n\t\t}\n\t\tsetItemToDelete(null);\n\t};\n\n\tconst handleCancel = () => {\n\t\tsetItemToDelete(null);\n\t\tsetIsConfirmOpen(false);\n\t};\n\n\tconst somethingToEncode = () => {\n\t\tif (videoFormats) {\n\t\t\t// Check if any format is checked AND available AND not already in a terminal/pending state\n\t\t\treturn Object.values(videoFormats).some(\n\t\t\t\t(obj) =>\n\t\t\t\t\tobj.checked &&\n\t\t\t\t\tobj.status !== 'queued' &&\n\t\t\t\t\tobj.status !== 'processing' &&\n\t\t\t\t\tobj.status !== 'completed' &&\n\t\t\t\t\tobj.status !== 'pending_replacement'\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t};\n\n\tconst encodeButtonTitle = () => {\n\t\tif (somethingToEncode()) {\n\t\t\treturn isLoading ? __( 'Loading', 'video-embed-thumbnail-generator' ) : __( 'Encode selected formats', 'video-embed-thumbnail-generator' );\n\t\t}\n\n\t\treturn __( 'Select formats to encode', 'video-embed-thumbnail-generator' );\n\t};\n\n\tconst isEncodeButtonDisabled =\n\t\tisLoading || ffmpeg_exists !== true || !somethingToEncode();\n\n\tconst confirmDialogMessage = () => {\n\t\tif (!itemToDelete) {\n\t\t\treturn '';\n\t\t}\n\t\tif (itemToDelete.type === 'file') {\n\t\t\treturn sprintf(\n\t\t\t\t/* translators: %s is the name of a video format (eg: H264 MP4 HD (720p) ) */\n\t\t\t\t__(\n\t\t\t\t\t'You are about to permanently delete the encoded %s video file from your site. This action cannot be undone.'\n\t\t\t\t),\n\t\t\t\titemToDelete.name\n\t\t\t);\n\t\t}\n\t\tif (itemToDelete.type === 'job') {\n\t\t\treturn sprintf(\n\t\t\t\t/* translators: %s is the name of a video format (eg: H264 MP4 HD (720p) ) */\n\t\t\t\t__(\n\t\t\t\t\t'You are about to permanently delete the encoding job for the %s video. This will also delete the encoded video file if it exists (if created by this job and not yet a separate attachment). This action cannot be undone.'\n\t\t\t\t),\n\t\t\t\titemToDelete.name\n\t\t\t);\n\t\t}\n\t};\n\n\tconst canUploadFiles = useSelect(\n\t\t(select) => select(coreStore).canUser('create', 'media', id),\n\t\t[id]\n\t);\n\n\tconst groupedFormats = Object.values(videoFormats).reduce((acc, format) => {\n\t\tif (!format.codec || !format.codec.id) {\n\t\t\treturn acc;\n\t\t}\n\t\tconst codecId = format.codec.id;\n\t\tif (!acc[codecId]) {\n\t\t\tacc[codecId] = {\n\t\t\t\tname: format.codec.name,\n\t\t\t\tformats: [],\n\t\t\t};\n\t\t}\n\t\tacc[codecId].formats.push(format);\n\t\t// sort formats by height\n\t\tacc[codecId].formats.sort(\n\t\t\t(a, b) => b.resolution.height - a.resolution.height\n\t\t);\n\t\treturn acc;\n\t}, {});\n\n\treturn (\n\t\t<>\n\t\t\t<PanelBody title={__( 'Additional Formats', 'video-embed-thumbnail-generator' )}>\n\t\t\t\t<PanelRow>\n\t\t\t\t\t{videoFormats ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<ul\n\t\t\t\t\t\t\t\tclassName={`videopack-formats-list${\n\t\t\t\t\t\t\t\t\tffmpeg_exists === true ? '' : ' no-ffmpeg'\n\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{Object.keys(groupedFormats).map((codecId) => {\n\t\t\t\t\t\t\t\t\tconst codecGroup = groupedFormats[codecId];\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\toptions.encode[codecId]?.enabled !== true\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<li key={codecId}>\n\t\t\t\t\t\t\t\t\t\t\t<h4 className=\"videopack-codec-name\">\n\t\t\t\t\t\t\t\t\t\t\t\t{codecGroup.name}\n\t\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t\t\t\t\t{codecGroup.formats.map(\n\t\t\t\t\t\t\t\t\t\t\t\t\t(formatData) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst formatId =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatData.format_id;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<EncodeFormatStatus\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={formatId}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatId={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatId\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatData={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatData\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tffmpegExists={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tffmpeg_exists\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonCheckboxChange={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleFormatCheckbox\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSelectFormat={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSelectFormat\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonDeleteFile={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\topenConfirmDialog(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'file',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatId\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonCancelJob={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\topenConfirmDialog(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'job',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatId\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeleteInProgress={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeleteInProgress\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t<ConfirmDialog\n\t\t\t\t\t\t\t\tisOpen={isConfirmOpen}\n\t\t\t\t\t\t\t\tonConfirm={handleConfirm}\n\t\t\t\t\t\t\t\tonCancel={handleCancel}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{confirmDialogMessage()}\n\t\t\t\t\t\t\t</ConfirmDialog>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</PanelRow>\n\t\t\t\t{ffmpeg_exists === true && videoFormats && canUploadFiles && (\n\t\t\t\t\t<PanelRow>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\tonClick={handleEnqueue}\n\t\t\t\t\t\t\ttitle={encodeButtonTitle()}\n\t\t\t\t\t\t\ttext={__( 'Encode', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t\t\tdisabled={isEncodeButtonDisabled}\n\t\t\t\t\t\t></Button>\n\t\t\t\t\t\t{isLoading && <Spinner />}\n\t\t\t\t\t\t{encodeMessage && (\n\t\t\t\t\t\t\t<span className=\"videopack-encode-message\">\n\t\t\t\t\t\t\t\t{encodeMessage}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</PanelRow>\n\t\t\t\t)}\n\t\t\t</PanelBody>\n\t\t</>\n\t);\n};\n\nexport default AdditionalFormats;\n","import { __, sprintf } from '@wordpress/i18n';\nimport {\n\tButton,\n\tCheckboxControl,\n\tSpinner,\n\t__experimentalDivider as Divider,\n} from '@wordpress/components';\nimport { MediaUpload } from '@wordpress/media-utils';\nimport EncodeProgress from './EncodeProgress';\n\nconst EncodeFormatStatus = ({\n\tformatId,\n\tformatData,\n\tffmpegExists,\n\tonCheckboxChange,\n\tonSelectFormat,\n\tonDeleteFile,\n\tonCancelJob,\n\tdeleteInProgress,\n}) => {\n\tif (!formatData) {\n\t\treturn <Spinner />;\n\t}\n\n\tconst getCheckboxCheckedState = (data) => {\n\t\treturn data.checked || data.status === 'queued';\n\t};\n\n\tconst getCheckboxDisabledState = (data) => {\n\t\treturn (\n\t\t\tdata.exists ||\n\t\t\tdata.status === 'queued' ||\n\t\t\tdata.status === 'encoding' ||\n\t\t\tdata.status === 'processing' ||\n\t\t\tdata.status === 'completed'\n\t\t);\n\t};\n\n\treturn (\n\t\t<li key={formatId}>\n\t\t\t{ffmpegExists === true ? (\n\t\t\t\t<CheckboxControl\n\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\tclassName=\"videopack-format\"\n\t\t\t\t\tlabel={formatData.label}\n\t\t\t\t\tchecked={getCheckboxCheckedState(formatData)}\n\t\t\t\t\tdisabled={getCheckboxDisabledState(formatData)}\n\t\t\t\t\tonChange={(event) => onCheckboxChange(event, formatId)}\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<span className=\"videopack-format\">{formatData.label}</span>\n\t\t\t)}\n\n\t\t\t{formatData.status !== 'not_encoded' && (\n\t\t\t\t<span className=\"videopack-format-status\">\n\t\t\t\t\t{formatData.status_l10n}\n\t\t\t\t</span>\n\t\t\t)}\n\n\t\t\t{formatData.status === 'not_encoded' && !formatData.was_picked && (\n\t\t\t\t<MediaUpload\n\t\t\t\t\ttitle={__( 'Choose existing file', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\tonSelect={onSelectFormat(formatId)}\n\t\t\t\t\tallowedTypes={['video']}\n\t\t\t\t\trender={({ open }) => (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\tonClick={open}\n\t\t\t\t\t\t\tclassName=\"videopack-format-button\"\n\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{__( 'Select', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t{formatData.was_picked && (\n\t\t\t\t<MediaUpload\n\t\t\t\t\ttitle={sprintf(\n\t\t\t\t\t\t/* translators: %s is the label of a video resolution (eg: 720p ) */\n\t\t\t\t\t\t__( 'Replace %s', 'video-embed-thumbnail-generator' ),\n\t\t\t\t\t\tformatData.label\n\t\t\t\t\t)}\n\t\t\t\t\tonSelect={onSelectFormat(formatId)}\n\t\t\t\t\tallowedTypes={['video']}\n\t\t\t\t\trender={({ open }) => (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\tonClick={open}\n\t\t\t\t\t\t\tclassName=\"videopack-format-button\"\n\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\ttitle={__( 'Replace file', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{__( 'Replace', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t{formatData.deletable && formatData.id && (\n\t\t\t\t<Button\n\t\t\t\t\tisBusy={deleteInProgress === formatId}\n\t\t\t\t\tonClick={onDeleteFile}\n\t\t\t\t\tvariant=\"link\"\n\t\t\t\t\ttext={__( 'Delete Permanently', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\tisDestructive\n\t\t\t\t/>\n\t\t\t)}\n\n\t\t\t{(formatData.encoding_now || formatData.status === 'failed') && (\n\t\t\t\t<EncodeProgress\n\t\t\t\t\tformatData={formatData}\n\t\t\t\t\tonCancelJob={onCancelJob}\n\t\t\t\t\tdeleteInProgress={deleteInProgress}\n\t\t\t\t/>\n\t\t\t)}\n\t\t\t<Divider />\n\t\t</li>\n\t);\n};\n\nexport default EncodeFormatStatus;\n","import { __, sprintf } from '@wordpress/i18n';\nimport { Button } from '@wordpress/components';\n\nconst EncodeProgress = ({ formatData, onCancelJob, deleteInProgress }) => {\n\tconst convertToTimecode = (time) => {\n\t\tif (time === null || time === undefined || isNaN(time)) {\n\t\t\treturn '--:--';\n\t\t}\n\t\tconst padZero = (num) => Math.floor(num).toString().padStart(2, '0');\n\n\t\tconst h = Math.floor(time / 3600);\n\t\tconst m = Math.floor((time % 3600) / 60);\n\t\tconst s = Math.floor(time % 60);\n\n\t\tconst hh = h > 0 ? padZero(h) + ':' : '';\n\t\tconst mm = padZero(m);\n\t\tconst ss = padZero(s);\n\n\t\treturn hh + mm + ':' + ss;\n\t};\n\n\tif (formatData?.encoding_now && formatData?.progress) {\n\t\tconst percent = Math.round(formatData.progress.percent);\n\t\tconst percentText = sprintf('%d%%', percent);\n\n\t\treturn (\n\t\t\t<div className=\"videopack-encode-progress\">\n\t\t\t\t<div className=\"videopack-meter\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"videopack-meter-bar\"\n\t\t\t\t\t\tstyle={{ width: percentText }}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className=\"videopack-meter-text\">\n\t\t\t\t\t\t\t{percentText}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t{formatData.job_id && (\n\t\t\t\t\t<Button\n\t\t\t\t\t\tonClick={onCancelJob}\n\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\tisDestructive\n\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\tisBusy={deleteInProgress === formatData.job_id}\n\t\t\t\t\t>\n\t\t\t\t\t\t{__( 'Cancel', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t</Button>\n\t\t\t\t)}\n\t\t\t\t<div className=\"videopack-encode-progress-small-text\">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{__( 'Elapsed:', 'video-embed-thumbnail-generator' ) +\n\t\t\t\t\t\t\t' ' +\n\t\t\t\t\t\t\tconvertToTimecode(formatData.progress.elapsed)}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{__( 'Remaining:', 'video-embed-thumbnail-generator' ) +\n\t\t\t\t\t\t\t' ' +\n\t\t\t\t\t\t\tconvertToTimecode(formatData.progress.remaining)}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span>{__( 'fps:', 'video-embed-thumbnail-generator' ) + ' ' + formatData.progress.fps}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tif (formatData?.status === 'failed' && formatData?.error_message) {\n\t\treturn (\n\t\t\t<div className=\"videopack-encode-error\">\n\t\t\t\t{sprintf(__( 'Error: %s', 'video-embed-thumbnail-generator' ), formatData.error_message)}\n\t\t\t\t{formatData.job_id && (\n\t\t\t\t\t<Button\n\t\t\t\t\t\tonClick={() => onCancelJob(formatData.job_id)}\n\t\t\t\t\t\tvariant=\"link\"\n\t\t\t\t\t\ttext={__( 'Delete Job', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t\tisDestructive\n\t\t\t\t\t\tisBusy={deleteInProgress === formatData.job_id}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn null;\n};\n\nexport default EncodeProgress;\n","/* global Image, videopack_config */\n\nimport {\n\tBaseControl,\n\tButton,\n\tDashicon,\n\tIcon,\n\tPanelBody,\n\tRangeControl,\n\tSpinner,\n\tTextControl,\n} from '@wordpress/components';\nimport { useCallback, useRef, useEffect, useState } from '@wordpress/element';\nimport { MediaUpload } from '@wordpress/media-utils';\nimport { __ } from '@wordpress/i18n';\nimport {\n\tsaveAllThumbnails,\n\tsetPosterImage,\n\tgenerateThumbnail,\n\tcreateThumbnailFromCanvas,\n} from '../../utils/utils';\nimport {\n\tcaptureVideoFrame,\n\tcalculateTimecodes,\n} from '../../utils/video-capture';\n\nimport { chevronUp, chevronDown } from '@wordpress/icons';\nimport './Thumbnails.scss';\n\nconst Thumbnails = ({\n\tsetAttributes,\n\tattributes,\n\tvideoData, // Changed from attachment\n\toptions = {},\n}) => {\n\tconst { id, src, poster, poster_id, isExternal } = attributes;\n\tconst total_thumbnails =\n\t\tattributes.total_thumbnails ||\n\t\tvideoData?.record?.total_thumbnails ||\n\t\toptions.total_thumbnails;\n\tconst thumbVideoPanel = useRef();\n\tconst videoRef = useRef();\n\tconst posterImageButton = useRef();\n\tconst [isPlaying, setIsPlaying] = useState(false);\n\tconst [isOpened, setIsOpened] = useState(false);\n\tconst [currentTime, setCurrentTime] = useState(false);\n\tconst [thumbChoices, setThumbChoices] = useState([]);\n\tconst [isSaving, setIsSaving] = useState(false);\n\n\tconst VIDEO_POSTER_ALLOWED_MEDIA_TYPES = ['image'];\n\n\tuseEffect(() => {\n\t\tif (window.mejs && window.mejs.players && poster) {\n\t\t\t// Find the MediaElement.js player within the media modal\n\t\t\tconst mejsContainer = document.querySelector(\n\t\t\t\t'.media-modal .mejs-container, .wp_attachment_holder .mejs-container'\n\t\t\t);\n\t\t\tif (mejsContainer) {\n\t\t\t\tconst mejsId = mejsContainer.id;\n\t\t\t\tif (mejsId && window.mejs.players[mejsId]) {\n\t\t\t\t\tconst player = window.mejs.players[mejsId];\n\t\t\t\t\tplayer.setPoster(poster);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}, [poster]);\n\n\tfunction onSelectPoster(image) {\n\t\tsetAttributes({\n\t\t\t...attributes,\n\t\t\tposter: image.url,\n\t\t\tposter_id: Number(image.id),\n\t\t});\n\t}\n\n\tfunction onRemovePoster() {\n\t\tsetAttributes({ ...attributes, poster: undefined });\n\n\t\t// Move focus back to the Media Upload button.\n\t\tposterImageButton.current.focus();\n\t}\n\n\tconst handleGenerate = async (type = 'generate') => {\n\t\tsetIsSaving(true);\n\t\tconst ffmpegExists = videopack_config.ffmpeg_exists;\n\t\tconst browserThumbnailsEnabled = videopack_config.browser_thumbnails;\n\n\t\tif (!browserThumbnailsEnabled && ffmpegExists) {\n\t\t\t// Browser thumbnails explicitly disabled, use FFmpeg directly\n\t\t\tconst newThumbImages = [];\n\t\t\tfor (let i = 1; i <= Number(total_thumbnails); i++) {\n\t\t\t\tconst response = await generateThumb(i, type);\n\t\t\t\tconst thumb = {\n\t\t\t\t\tsrc: response.real_thumb_url,\n\t\t\t\t\ttype: 'ffmpeg',\n\t\t\t\t};\n\t\t\t\tnewThumbImages.push(thumb);\n\t\t\t\tsetThumbChoices([...newThumbImages]); // Update incrementally\n\t\t\t}\n\t\t\tsetIsSaving(false);\n\t\t} else {\n\t\t\t// Attempt browser-based generation\n\t\t\tgenerateThumbCanvases(type);\n\t\t}\n\t};\n\n\tconst generateThumbCanvases = useCallback(async (type) => {\n\t\tconst thumbsInt = Number(total_thumbnails);\n\t\tconst newThumbCanvases = [];\n\t\tconst ffmpegExists = videopack_config.ffmpeg_exists;\n\n\t\tconst timePoints = calculateTimecodes(\n\t\t\tvideoRef.current.duration,\n\t\t\tthumbsInt,\n\t\t\t{ random: type === 'random' }\n\t\t);\n\n\t\tfor (const time of timePoints) {\n\t\t\tlet thumb;\n\t\t\ttry {\n\t\t\t\tconst canvas = await captureVideoFrame(\n\t\t\t\t\tvideoRef.current,\n\t\t\t\t\ttime,\n\t\t\t\t\toptions?.ffmpeg_thumb_watermark\n\t\t\t\t);\n\t\t\t\tthumb = {\n\t\t\t\t\tsrc: canvas.toDataURL(),\n\t\t\t\t\ttype: 'canvas',\n\t\t\t\t\tcanvasObject: canvas,\n\t\t\t\t};\n\t\t\t\tnewThumbCanvases.push(thumb);\n\t\t\t\tsetThumbChoices([...newThumbCanvases]); // Update incrementally\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error generating canvas thumbnail:', error);\n\t\t\t\tif (ffmpegExists) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst response = await generateThumb(\n\t\t\t\t\t\t\tnewThumbCanvases.length + 1,\n\t\t\t\t\t\t\ttype\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthumb = {\n\t\t\t\t\t\t\tsrc: response.real_thumb_url,\n\t\t\t\t\t\t\ttype: 'ffmpeg'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tnewThumbCanvases.push(thumb);\n\t\t\t\t\t\tsetThumbChoices([...newThumbCanvases]);\n\t\t\t\t\t} catch (ffmpegError) {}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsetIsSaving(false);\n\t});\n\n\t// function to toggle video playback\n\tconst togglePlayback = () => {\n\t\tif (videoRef.current?.paused) {\n\t\t\tvideoRef.current.play();\n\t\t\tsetIsPlaying(true);\n\t\t} else {\n\t\t\tvideoRef.current?.pause();\n\t\t\tsetIsPlaying(false);\n\t\t}\n\t};\n\n\tconst pauseVideo = () => {\n\t\tvideoRef.current.pause();\n\t\tsetIsPlaying(false);\n\t};\n\n\tconst playVideo = () => {\n\t\tvideoRef.current.play();\n\t\tsetIsPlaying(true);\n\t};\n\n\t// function to handle slider changes\n\tconst handleSliderChange = (value) => {\n\t\tvideoRef.current.currentTime = value;\n\t\tsetCurrentTime(value);\n\t};\n\n\tuseEffect(() => {\n\t\tconst handleTimeUpdate = () => {\n\t\t\tsetCurrentTime(videoRef.current.currentTime); // update currentTime state variable\n\t\t};\n\n\t\tvideoRef.current?.addEventListener('timeupdate', handleTimeUpdate);\n\t\treturn () => {\n\t\t\tvideoRef.current?.removeEventListener(\n\t\t\t\t'timeupdate',\n\t\t\t\thandleTimeUpdate\n\t\t\t);\n\t\t};\n\t}, []);\n\n\tconst handleSaveThumbnail = (event, thumb) => {\n\t\tevent.currentTarget.classList.add('saving');\n\t\tsetIsSaving(true);\n\t\tif (thumb.type === 'ffmpeg') {\n\t\t\tsetImgAsPoster(thumb.src);\n\t\t} else {\n\t\t\tsetCanvasAsPoster(thumb.canvasObject);\n\t\t}\n\t};\n\n\tconst handleSaveAllThumbnails = async () => {\n\t\tsetIsSaving(true); // Show spinner for the whole operation\n\t\tconst firstThumbType = thumbChoices[0]?.type; // Assuming all generated thumbs are of the same type\n\n\t\tif (firstThumbType === 'canvas') {\n\t\t\tconst uploadPromises = thumbChoices.map((thumb) => {\n\t\t\t\treturn createThumbnailFromCanvas(thumb.canvasObject, id, src);\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tawait Promise.all(uploadPromises);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error saving all canvas thumbnails:', error);\n\t\t\t}\n\t\t\tsetThumbChoices([]);\n\t\t} else if (firstThumbType === 'ffmpeg') {\n\t\t\t// For FFmpeg thumbnails, send their temporary URLs to the server to be saved\n\t\t\tconst thumbUrls = thumbChoices.map((thumb) => thumb.src);\n\t\t\ttry {\n\t\t\t\tawait saveAllThumbnails(id, thumbUrls);\n\t\t\t\tsetThumbChoices([]); // Clear choices after saving\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error saving all FFmpeg thumbnails:', error);\n\t\t\t}\n\t\t}\n\t\tsetIsSaving(false); // Hide spinner after all operations complete\n\t};\n\n\tconst setCanvasAsPoster = async (canvasObject) => {\n\t\tsetIsSaving(true);\n\t\ttry {\n\t\t\tconst response = await createThumbnailFromCanvas(\n\t\t\t\tcanvasObject,\n\t\t\t\tid,\n\t\t\t\tsrc\n\t\t\t);\n\n\t\t\tsetPosterData(response.thumb_url, response.thumb_id);\n\t\t} catch (error) {\n\t\t\tconsole.error('Error uploading thumbnail:', error);\n\t\t} finally {\n\t\t\tsetIsSaving(false);\n\t\t}\n\t};\n\n\tconst setPosterData = async (new_poster, new_poster_id) => {\n\t\ttry {\n\t\t\tconst metaData = {};\n\t\t\tif (new_poster) {\n\t\t\t\t// Only include if new_poster has a value\n\t\t\t\tmetaData['_kgflashmediaplayer-poster'] = new_poster;\n\t\t\t\tmetaData['_kgflashmediaplayer-poster-id'] =\n\t\t\t\t\tNumber(new_poster_id);\n\t\t\t\tmetaData['_videopack-meta'] = {\n\t\t\t\t\t...videoData?.record?.meta?.['_videopack-meta'],\n\t\t\t\t\tposter: new_poster,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tawait videoData?.edit({\n\t\t\t\tfeatured_media: new_poster_id ? Number(new_poster_id) : null,\n\t\t\t\tmeta: metaData,\n\t\t\t});\n\t\t\tawait videoData?.save();\n\n\t\t\t// Refresh the media library grid to show the updated thumbnail.\n\t\t\tif (wp.media && wp.media.frame) {\n\t\t\t\tif (\n\t\t\t\t\twp.media.frame.content.get() &&\n\t\t\t\t\twp.media.frame.content.get().collection\n\t\t\t\t) {\n\t\t\t\t\tconst collection = wp.media.frame.content.get().collection;\n\t\t\t\t\tcollection.props.set({ ignore: new Date().getTime() });\n\t\t\t\t} else if (wp.media.frame.library) {\n\t\t\t\t\t// Fallback for different states of the media modal.\n\t\t\t\t\twp.media.frame.library.props.set({\n\t\t\t\t\t\tignore: new Date().getTime(),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetAttributes({\n\t\t\t\t...attributes,\n\t\t\t\tposter: new_poster,\n\t\t\t\tposter_id: new_poster_id,\n\t\t\t});\n\t\t\tsetThumbChoices([]);\n\t\t\tsetIsSaving(false);\n\t\t} catch (error) {\n\t\t\tconsole.error('Error updating attachment:', error);\n\t\t\tsetIsSaving(false);\n\t\t}\n\t};\n\n\tconst setImgAsPoster = async (thumb_url) => {\n\t\ttry {\n\t\t\tconst response = await setPosterImage(id, thumb_url);\n\t\t\tsetPosterData(response.thumb_url, response.thumb_id);\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t}\n\t};\n\n\tconst generateThumb = async (i, type) => {\n\t\ttry {\n\t\t\tconst response = await generateThumbnail(\n\t\t\t\tsrc,\n\t\t\t\ttotal_thumbnails,\n\t\t\t\ti,\n\t\t\t\tid,\n\t\t\t\ttype\n\t\t\t);\n\n\t\t\treturn response;\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t}\n\t};\n\n\tconst handleVideoKeyboardControl = (event) => {\n\t\tevent.stopImmediatePropagation();\n\n\t\tswitch (event.code) {\n\t\t\tcase 'Space': // spacebar\n\t\t\t\ttogglePlayback();\n\t\t\t\tbreak;\n\n\t\t\tcase 'ArrowLeft': // left\n\t\t\t\tpauseVideo();\n\t\t\t\tvideoRef.current.currentTime =\n\t\t\t\t\tvideoRef.current.currentTime - 0.042;\n\t\t\t\tbreak;\n\n\t\t\tcase 'ArrowRight': // right\n\t\t\t\tpauseVideo();\n\t\t\t\tvideoRef.current.currentTime =\n\t\t\t\t\tvideoRef.current.currentTime + 0.042;\n\t\t\t\tbreak;\n\n\t\t\tcase 'KeyJ': //j\n\t\t\t\tif (isPlaying) {\n\t\t\t\t\tvideoRef.current.playbackRate = Math.max(\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tvideoRef.current.playbackRate - 1\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'KeyK': // k\n\t\t\t\tpauseVideo();\n\t\t\t\tbreak;\n\n\t\t\tcase 'KeyL': //l\n\t\t\t\tif (isPlaying) {\n\t\t\t\t\tvideoRef.current.playbackRate =\n\t\t\t\t\t\tvideoRef.current.playbackRate + 1;\n\t\t\t\t}\n\t\t\t\tplayVideo();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\treturn; // exit this handler for other keys\n\t\t}\n\t\tevent.preventDefault(); // prevent the default action (scroll / move caret)\n\t};\n\n\tconst handleUseThisFrame = async () => {\n\t\tsetIsSaving(true);\n\t\tconst canvas = await captureVideoFrame(\n\t\t\tvideoRef.current,\n\t\t\tvideoRef.current.currentTime,\n\t\t\toptions?.ffmpeg_thumb_watermark\n\t\t);\n\t\tsetCanvasAsPoster(canvas); // Pass the canvas object directly, index will be null\n\t};\n\n\tconst handleToggleVideoPlayer = (event) => {\n\t\tevent.preventDefault();\n\t\tconst next = !isOpened;\n\t\tsetIsOpened(next);\n\t\tif (next && thumbVideoPanel.current) {\n\t\t\tthumbVideoPanel.current.focus();\n\t\t\tthumbVideoPanel.current.addEventListener(\n\t\t\t\t'keydown',\n\t\t\t\thandleVideoKeyboardControl\n\t\t\t);\n\t\t} else {\n\t\t\tthumbVideoPanel.current.addEventListener(\n\t\t\t\t'keydown',\n\t\t\t\thandleVideoKeyboardControl\n\t\t\t);\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className=\"videopack-thumbnail-generator\">\n\t\t\t<PanelBody title={__( 'Thumbnails', 'video-embed-thumbnail-generator' )}>\n\t\t\t\t{poster && (\n\t\t\t\t\t<img\n\t\t\t\t\t\tclassName=\"videopack-current-thumbnail\"\n\t\t\t\t\t\tsrc={poster}\n\t\t\t\t\t\talt={__( 'Current Thumbnail', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t<BaseControl className=\"editor-video-poster-control\">\n\t\t\t\t\t<BaseControl.VisualLabel>\n\t\t\t\t\t\t{__( 'Video Thumbnail', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t</BaseControl.VisualLabel>\n\t\t\t\t\t<MediaUpload\n\t\t\t\t\t\ttitle={__( 'Select video thumbnail', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t\tonSelect={onSelectPoster}\n\t\t\t\t\t\tallowedTypes={VIDEO_POSTER_ALLOWED_MEDIA_TYPES}\n\t\t\t\t\t\trender={({ open }) => (\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\tonClick={open}\n\t\t\t\t\t\t\t\tref={posterImageButton}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{!poster ? __( 'Select', 'video-embed-thumbnail-generator' ) : __( 'Replace', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t/>\n\t\t\t\t\t{!!poster && (\n\t\t\t\t\t\t<Button onClick={onRemovePoster} variant=\"tertiary\">\n\t\t\t\t\t\t\t{__( 'Remove', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</BaseControl>\n\t\t\t\t<TextControl // This is the UI control for total_thumbnails.\n\t\t\t\t\tvalue={total_thumbnails}\n\t\t\t\t\tonChange={(value) => {\n\t\t\t\t\t\tif (!value) {\n\t\t\t\t\t\t\tsetAttributes({\n\t\t\t\t\t\t\t\t...attributes,\n\t\t\t\t\t\t\t\ttotal_thumbnails: '',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetAttributes({\n\t\t\t\t\t\t\t\t...attributes,\n\t\t\t\t\t\t\t\ttotal_thumbnails: Number(value),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tclassName=\"videopack-total-thumbnails\"\n\t\t\t\t\tdisabled={isSaving}\n\t\t\t\t/>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\tonClick={() => handleGenerate('generate')}\n\t\t\t\t\tclassName=\"videopack-generate\"\n\t\t\t\t\tdisabled={isSaving}\n\t\t\t\t>\n\t\t\t\t\t{__( 'Generate', 'video-embed-thumbnail-generator' )}\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\tonClick={() => handleGenerate('random')}\n\t\t\t\t\tclassName=\"videopack-generate\"\n\t\t\t\t\tdisabled={isSaving}\n\t\t\t\t>\n\t\t\t\t\t{__( 'Random', 'video-embed-thumbnail-generator' )}\n\t\t\t\t</Button>\n\t\t\t\t{thumbChoices.length > 0 && (\n\t\t\t\t\t<Button\n\t\t\t\t\t\tvariant=\"primary\"\n\t\t\t\t\t\tonClick={handleSaveAllThumbnails}\n\t\t\t\t\t\tdisabled={isSaving}\n\t\t\t\t\t>\n\t\t\t\t\t\t{__( 'Save All', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t</Button>\n\t\t\t\t)}\n\t\t\t\t{thumbChoices.length > 0 && (\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={`videopack-thumbnail-holder${isSaving ? ' disabled' : ''}`}\n\t\t\t\t\t>\n\t\t\t\t\t\t{thumbChoices.map((thumb, index) => (\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclassName={\n\t\t\t\t\t\t\t\t\t'videopack-thumbnail spinner-container'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\tonClick={(event) => {\n\t\t\t\t\t\t\t\t\thandleSaveThumbnail(event, thumb, index);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tsrc={thumb.src}\n\t\t\t\t\t\t\t\t\talt={`Thumbnail ${index + 1}`}\n\t\t\t\t\t\t\t\t\ttitle={__( 'Save and set thumbnail', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{isSaving && <Spinner />}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t<div\n\t\t\t\t\tclassName={`components-panel__body videopack-thumb-video ${isOpened ? 'is-opened' : ''}`}\n\t\t\t\t>\n\t\t\t\t\t<h2 className=\"components-panel__body-title\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName=\"components-button components-panel__body-toggle\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tonClick={handleToggleVideoPlayer}\n\t\t\t\t\t\t\taria-expanded={isOpened}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span aria-hidden=\"true\">\n\t\t\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\t\t\tclassName=\"components-panel__arrow\"\n\t\t\t\t\t\t\t\t\ticon={isOpened ? chevronUp : chevronDown}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t{__( 'Choose From Video', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</h2>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName={`videopack-thumb-video-panel spinner-container${\n\t\t\t\t\t\t\tisSaving ? ' saving' : ''\n\t\t\t\t\t\t}`}\n\t\t\t\t\t\ttabIndex={0}\n\t\t\t\t\t\tref={thumbVideoPanel}\n\t\t\t\t\t>\n\t\t\t\t\t\t<video\n\t\t\t\t\t\t\tsrc={src}\n\t\t\t\t\t\t\tref={videoRef}\n\t\t\t\t\t\t\tmuted={true}\n\t\t\t\t\t\t\tpreload=\"metadata\"\n\t\t\t\t\t\t\tonClick={togglePlayback}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div className=\"videopack-thumb-video-controls\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"videopack-play-pause\"\n\t\t\t\t\t\t\t\tonClick={togglePlayback}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Dashicon\n\t\t\t\t\t\t\t\t\ticon={\n\t\t\t\t\t\t\t\t\t\tisPlaying\n\t\t\t\t\t\t\t\t\t\t\t? 'controls-pause'\n\t\t\t\t\t\t\t\t\t\t\t: 'controls-play'\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{!isNaN(videoRef.current?.duration) && (\n\t\t\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\t\t\tmax={videoRef.current.duration}\n\t\t\t\t\t\t\t\t\tstep=\"any\"\n\t\t\t\t\t\t\t\t\tinitialPosition={0}\n\t\t\t\t\t\t\t\t\tvalue={videoRef.current.currentTime}\n\t\t\t\t\t\t\t\t\tonChange={handleSliderChange}\n\t\t\t\t\t\t\t\t\tclassName=\"videopack-thumbvideo-slider\"\n\t\t\t\t\t\t\t\t\ttype=\"slider\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\tonClick={handleUseThisFrame}\n\t\t\t\t\t\t\tclassName=\"videopack-use-this-frame\"\n\t\t\t\t\t\t\tdisabled={isSaving}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{__( 'Use this frame', 'video-embed-thumbnail-generator' )}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{isSaving && <Spinner />}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</PanelBody>\n\t\t</div>\n\t);\n};\n\nexport default Thumbnails;\n","import { Spinner } from '@wordpress/components';\nimport { useEntityRecord } from '@wordpress/core-data';\nimport { useState, useEffect } from '@wordpress/element';\nimport Thumbnails from '../../../components/Thumbnails/Thumbnails.js';\nimport AdditionalFormats from '../../../components/AdditionalFormats/AdditionalFormats.js';\nimport { getSettings } from '../../../utils/utils.js';\n\nconst AttachmentDetails = ({ attachmentId }) => {\n\tconst [options, setOptions] = useState();\n\tconst [attributes, setAttributes] = useState();\n\tconst attachment = useEntityRecord(\n\t\t'postType',\n\t\t'attachment',\n\t\t!isNaN(attachmentId) ? attachmentId : null\n\t);\n\n\tuseEffect(() => {\n\t\tgetSettings().then((response) => {\n\t\t\tsetOptions(response);\n\t\t});\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (attachment.hasResolved && !attributes) {\n\t\t\tconst combinedAttributes = {\n\t\t\t\tid: attachmentId,\n\t\t\t\ttotal_thumbnails:\n\t\t\t\t\tattachment.record?.meta?.['_videopack-meta']\n\t\t\t\t\t\t?.total_thumbnails || options?.total_thumbnails,\n\t\t\t\tsrc: attachment.record?.source_url,\n\t\t\t\tposter:\n\t\t\t\t\tattachment.record?.meta?.['_kgflashmediaplayer-poster'] ||\n\t\t\t\t\tattachment.record?.media_details?.sizes?.full?.source_url ||\n\t\t\t\t\tattachment.record?.image?.src,\n\t\t\t\tposter_id:\n\t\t\t\t\tattachment.record?.meta?.['_kgflashmediaplayer-poster-id'],\n\t\t\t};\n\t\t\tsetAttributes(combinedAttributes);\n\t\t}\n\t}, [options, attachment, attributes, attachmentId]);\n\n\tif (attributes && attachment.hasResolved && options) {\n\t\treturn (\n\t\t\t<div className=\"videopack-attachment-details\">\n\t\t\t\t<Thumbnails\n\t\t\t\t\tsetAttributes={setAttributes}\n\t\t\t\t\tattributes={attributes}\n\t\t\t\t\tvideoData={attachment}\n\t\t\t\t\toptions={options}\n\t\t\t\t/>\n\t\t\t\t<AdditionalFormats attributes={attributes} options={options} />\n\t\t\t</div>\n\t\t);\n\t}\n\treturn <Spinner />;\n};\n\nexport default AttachmentDetails;\n","import apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs, getFilename } from '@wordpress/url';\n\nexport const getQueue = async () => {\n\ttry {\n\t\tconst response = await apiFetch({\n\t\t\tpath: '/videopack/v1/queue',\n\t\t});\n\t\treturn response || [];\n\t} catch (error) {\n\t\tconsole.error('Error fetching queue:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const toggleQueue = async (action) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: '/videopack/v1/queue/control',\n\t\t\tmethod: 'POST',\n\t\t\tdata: { action },\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error toggling queue:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const clearQueue = async (type) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: '/videopack/v1/queue/clear',\n\t\t\tmethod: 'DELETE',\n\t\t\tdata: { type },\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error clearing queue:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const deleteJob = async (jobId) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: `/videopack/v1/queue/${jobId}`,\n\t\t\tmethod: 'DELETE',\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error deleting job:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const removeJob = async (jobId) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: `/videopack/v1/queue/remove/${jobId}`,\n\t\t\tmethod: 'DELETE',\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error removing job:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const getVideoFormats = async (attachmentId) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: `/videopack/v1/formats/${attachmentId}`,\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error fetching video formats:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const enqueueJob = async (attachmentId, src, formats) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: `/videopack/v1/queue/${attachmentId}`,\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\turl: src,\n\t\t\t\tformats,\n\t\t\t},\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error enqueuing job:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const assignFormat = async (mediaId, formatId, parentId) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: `/wp/v2/media/${mediaId}`,\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\tmeta: {\n\t\t\t\t\t'_kgflashmediaplayer-format': formatId,\n\t\t\t\t\t'_kgflashmediaplayer-parent': parentId,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error assigning format:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const deleteFile = async (attachmentId) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: `/wp/v2/media/${attachmentId}?force=true`,\n\t\t\tmethod: 'DELETE',\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error deleting file:', error);\n\t\tthrow error;\n\t}\n};\n\n/**\n * Converts a canvas to a blob and uploads it as a thumbnail.\n *\n * @param {HTMLCanvasElement} canvas       The canvas element to upload.\n * @param {number}            attachmentId The ID of the video attachment.\n * @param {string}            videoSrc     The URL of the video (used for filename).\n * @return {Promise<Object>} The response from the upload endpoint.\n */\nexport const createThumbnailFromCanvas = ( canvas, attachmentId, videoSrc ) => {\n\treturn new Promise( ( resolve, reject ) => {\n\t\tcanvas.toBlob( async ( blob ) => {\n\t\t\tif ( ! blob ) {\n\t\t\t\treject( new Error( 'Canvas is empty' ) );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst formData = new FormData();\n\t\t\t\tformData.append( 'file', blob, 'thumbnail.jpg' );\n\t\t\t\tformData.append( 'attachment_id', attachmentId );\n\t\t\t\tformData.append( 'post_name', getFilename( videoSrc ) );\n\n\t\t\t\tconst response = await uploadThumbnail( formData );\n\t\t\t\tresolve( response );\n\t\t\t} catch ( error ) {\n\t\t\t\treject( error );\n\t\t\t}\n\t\t}, 'image/jpeg' );\n\t} );\n};\n\nexport const uploadThumbnail = async (formData) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: '/videopack/v1/thumbs/upload',\n\t\t\tmethod: 'POST',\n\t\t\tbody: formData,\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error uploading thumbnail:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const saveAllThumbnails = async (attachment_id, thumb_urls) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: '/videopack/v1/thumbs/save_all',\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\tattachment_id,\n\t\t\t\tthumb_urls,\n\t\t\t},\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error saving all thumbnails:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const getVideoGallery = async (args) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: addQueryArgs('/videopack/v1/video_gallery', args),\n\t\t\tmethod: 'GET',\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error fetching video gallery:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const getUsersWithCapability = async (capability) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: `/wp/v2/users?capability=${capability}`,\n\t\t\tmethod: 'GET',\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error fetching users:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const getFreemiusPage = async (page) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: `/videopack/v1/freemius/${page}`,\n\t\t});\n\t} catch (error) {\n\t\tconsole.error(`Error fetching Freemius page '${page}':`, error);\n\t\tthrow error;\n\t}\n};\n\nexport const getRecentVideos = async (posts) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: `/videopack/v1/recent_videos?posts=${posts}`,\n\t\t\tmethod: 'GET',\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error fetching recent videos:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const testFFmpegCommand = async (codec, resolution, rotate) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: `/videopack/v1/ffmpeg-test/?codec=${codec}&resolution=${resolution}&rotate=${rotate}`,\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error testing FFmpeg command:', error);\n\t\tthrow error;\n\t}\n};\n\n\n\nexport const getSettings = async () => {\n\ttry {\n\t\tconst allSettings = await apiFetch({ path: '/wp/v2/settings' });\n\t\treturn allSettings.videopack_options || {};\n\t} catch (error) {\n\t\tconsole.error('Error fetching settings:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const saveWPSettings = async (newSettings) => {\n\ttry {\n\t\tconst response = await apiFetch({\n\t\t\tpath: '/wp/v2/settings',\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\tvideopack_options: newSettings,\n\t\t\t},\n\t\t});\n\t\treturn response.videopack_options || {};\n\t} catch (error) {\n\t\tconsole.error('Error saving WP settings:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const resetVideopackSettings = async () => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: '/videopack/v1/defaults',\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error resetting Videopack settings:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const setPosterImage = async (attachment_id, thumb_url) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: '/videopack/v1/thumbs',\n\t\t\tmethod: 'PUT',\n\t\t\tdata: {\n\t\t\t\tattachment_id,\n\t\t\t\tthumburl: thumb_url,\n\t\t\t},\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error setting poster image:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const generateThumbnail = async (\n\turl,\n\ttotal_thumbnails,\n\tthumbnail_index,\n\tattachment_id,\n\tgenerate_button\n) => {\n\ttry {\n\t\tconst path = addQueryArgs('/videopack/v1/thumbs', {\n\t\t\turl,\n\t\t\ttotal_thumbnails,\n\t\t\tthumbnail_index,\n\t\t\tattachment_id,\n\t\t\tgenerate_button,\n\t\t});\n\n\t\treturn await apiFetch({ path });\n\t} catch (error) {\n\t\tconsole.error('Error generating thumbnail:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const startBatchProcess = async (type, additionalData = {}) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: '/videopack/v1/batch/process',\n\t\t\tmethod: 'POST',\n\t\t\tdata: { type, ...additionalData },\n\t\t});\n\t} catch (error) {\n\t\tconsole.error(`Error starting ${type} batch processing:`, error);\n\t\tthrow error;\n\t}\n};\n\nexport const getBatchProgress = async (type) => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: `/videopack/v1/batch/progress?type=${type}`,\n\t\t\tmethod: 'GET',\n\t\t});\n\t} catch (error) {\n\t\tconsole.error(`Error fetching ${type} batch progress:`, error);\n\t\tthrow error;\n\t}\n};\n\nexport const getThumbnailCandidates = async () => {\n\ttry {\n\t\treturn await apiFetch({\n\t\t\tpath: '/videopack/v1/thumbs/candidates',\n\t\t\tmethod: 'GET',\n\t\t});\n\t} catch (error) {\n\t\tconsole.error('Error fetching thumbnail candidates:', error);\n\t\tthrow error;\n\t}\n};\n","import { __ } from '@wordpress/i18n';\n\n/**\n * Captures a frame from a video element or URL.\n *\n * @param {HTMLVideoElement|string} source           Video element or URL.\n * @param {number}                  time             Time in seconds to capture.\n * @param {Object}                  watermarkOptions Watermark settings.\n * @return {Promise<HTMLCanvasElement>} The canvas with the captured frame.\n */\nexport const captureVideoFrame = (source, time, watermarkOptions = null) => {\n\treturn new Promise((resolve, reject) => {\n\t\tlet video;\n\t\tlet isTempVideo = false;\n\n\t\tif (typeof source === 'string') {\n\t\t\tvideo = document.createElement('video');\n\t\t\tvideo.crossOrigin = 'anonymous';\n\t\t\tvideo.src = source;\n\t\t\tvideo.muted = true;\n\t\t\tvideo.preload = 'metadata';\n\t\t\tisTempVideo = true;\n\t\t} else {\n\t\t\tvideo = source;\n\t\t}\n\n\t\tconst onSeeked = async () => {\n\t\t\t// Clean up listeners if we added them\n\t\t\tif (isTempVideo) {\n\t\t\t\tvideo.removeEventListener('seeked', onSeeked);\n\t\t\t\tvideo.removeEventListener('error', onError);\n\t\t\t}\n\n\t\t\tconst canvas = document.createElement('canvas');\n\t\t\tcanvas.width = video.videoWidth;\n\t\t\tcanvas.height = video.videoHeight;\n\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\tctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n\t\t\tif (watermarkOptions && watermarkOptions.url) {\n\t\t\t\ttry {\n\t\t\t\t\tawait drawWatermark(canvas, watermarkOptions);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Watermark failed', e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresolve(canvas);\n\n\t\t\tif (isTempVideo) {\n\t\t\t\tvideo.src = '';\n\t\t\t\tvideo.load();\n\t\t\t}\n\t\t};\n\n\t\tconst onError = (e) => {\n\t\t\tif (isTempVideo) {\n\t\t\t\tvideo.removeEventListener('seeked', onSeeked);\n\t\t\t\tvideo.removeEventListener('error', onError);\n\t\t\t}\n\t\t\treject(e);\n\t\t};\n\n\t\tconst onLoadedMetadata = () => {\n\t\t\tlet seekTime = time;\n\t\t\tif (video.duration < seekTime) {\n\t\t\t\tseekTime = video.duration / 2;\n\t\t\t}\n\t\t\tvideo.currentTime = seekTime;\n\t\t};\n\n\t\tif (isTempVideo) {\n\t\t\tvideo.addEventListener('seeked', onSeeked);\n\t\t\tvideo.addEventListener('error', onError);\n\t\t\tvideo.addEventListener('loadedmetadata', onLoadedMetadata);\n\t\t\t// Trigger load\n\t\t\tvideo.load();\n\t\t} else {\n\t\t\t// For existing video element, just seek\n\t\t\tconst oneShotSeek = async () => {\n\t\t\t\tvideo.removeEventListener('seeked', oneShotSeek);\n\n\t\t\t\tconst canvas = document.createElement('canvas');\n\t\t\t\tcanvas.width = video.videoWidth;\n\t\t\t\tcanvas.height = video.videoHeight;\n\t\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\t\tctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n\t\t\t\tif (watermarkOptions && watermarkOptions.url) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait drawWatermark(canvas, watermarkOptions);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('Watermark failed', e);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresolve(canvas);\n\t\t\t};\n\t\t\tvideo.addEventListener('seeked', oneShotSeek);\n\t\t\tvideo.currentTime = time;\n\t\t}\n\t});\n};\n\n/**\n * Draws a watermark on the provided canvas.\n *\n * @param {HTMLCanvasElement} canvas  The canvas to draw on.\n * @param {Object}            options Watermark options (url, scale, align, x, valign, y).\n * @return {Promise<HTMLCanvasElement>}\n */\nexport const drawWatermark = (canvas, options) => {\n\treturn new Promise((resolve, reject) => {\n\t\tconst { url, scale, align, x, valign, y } = options;\n\t\tconst ctx = canvas.getContext('2d');\n\t\tconst img = new Image();\n\t\timg.crossOrigin = 'Anonymous';\n\t\timg.src = url;\n\n\t\timg.onload = () => {\n\t\t\tconst canvasWidth = canvas.width;\n\t\t\tconst canvasHeight = canvas.height;\n\t\t\tconst watermarkWidth = (canvasWidth * scale) / 100;\n\t\t\tconst watermarkHeight = (canvasHeight * scale) / 100;\n\n\t\t\tconst horizontalOffset = (canvasWidth * x) / 100;\n\t\t\tconst verticalOffset = (canvasHeight * y) / 100;\n\n\t\t\tlet xPos, yPos;\n\n\t\t\tswitch (align) {\n\t\t\t\tcase 'left':\n\t\t\t\t\txPos = horizontalOffset;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'center':\n\t\t\t\t\txPos =\n\t\t\t\t\t\t(canvasWidth - watermarkWidth) / 2 + horizontalOffset;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'right':\n\t\t\t\t\txPos = canvasWidth - watermarkWidth - horizontalOffset;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\txPos = horizontalOffset;\n\t\t\t}\n\n\t\t\tswitch (valign) {\n\t\t\t\tcase 'top':\n\t\t\t\t\tyPos = verticalOffset;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'center':\n\t\t\t\t\tyPos =\n\t\t\t\t\t\t(canvasHeight - watermarkHeight) / 2 + verticalOffset;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bottom':\n\t\t\t\t\tyPos = canvasHeight - watermarkHeight - verticalOffset;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tyPos = verticalOffset;\n\t\t\t}\n\n\t\t\tctx.drawImage(img, xPos, yPos, watermarkWidth, watermarkHeight);\n\t\t\tresolve(canvas);\n\t\t};\n\n\t\timg.onerror = () =>\n\t\t\treject(\n\t\t\t\tnew Error(\n\t\t\t\t\t__(\n\t\t\t\t\t\t'Failed to load watermark image',\n\t\t\t\t\t\t'video-embed-thumbnail-generator'\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t);\n\t});\n};\n\n/**\n * Loads video metadata from a source.\n *\n * @param {string} source Video URL.\n * @return {Promise<HTMLVideoElement>} The video element with loaded metadata.\n */\nexport const getVideoMetadata = (source) => {\n\treturn new Promise((resolve, reject) => {\n\t\tconst video = document.createElement('video');\n\t\tvideo.preload = 'metadata';\n\t\tvideo.crossOrigin = 'anonymous';\n\t\tvideo.src = source;\n\t\tvideo.muted = true;\n\n\t\tconst timeout = setTimeout(() => {\n\t\t\treject(new Error('Video load timeout'));\n\t\t}, 30000);\n\n\t\tvideo.onloadedmetadata = () => {\n\t\t\tclearTimeout(timeout);\n\t\t\tresolve(video);\n\t\t};\n\n\t\tvideo.onerror = (e) => {\n\t\t\tclearTimeout(timeout);\n\t\t\treject(e);\n\t\t};\n\t});\n};\n\n/**\n * Calculates timecodes for thumbnail generation.\n *\n * @param {number} duration Total video duration.\n * @param {number} count    Number of thumbnails.\n * @param {Object} options  Options { position: number (0-100), random: boolean }.\n * @return {number[]} Array of timecodes.\n */\nexport const calculateTimecodes = (duration, count, options = {}) => {\n\tconst timecodes = [];\n\tconst { position = 50, random = false } = options;\n\n\tif (count === 1 && !random) {\n\t\ttimecodes.push(duration * (position / 100));\n\t} else {\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tlet time = ((i + 1) / (count + 1)) * duration;\n\t\t\tif (random) {\n\t\t\t\tconst randomOffset = Math.floor(Math.random() * (duration / count));\n\t\t\t\ttime = Math.max(time - randomOffset, 0);\n\t\t\t}\n\t\t\ttimecodes.push(time);\n\t\t}\n\t}\n\treturn timecodes;\n};\n","// extracted by mini-css-extract-plugin\nexport {};","// extracted by mini-css-extract-plugin\nexport {};","// extracted by mini-css-extract-plugin\nexport {};","module.exports = window[\"ReactJSXRuntime\"];","module.exports = window[\"wp\"][\"apiFetch\"];","module.exports = window[\"wp\"][\"components\"];","module.exports = window[\"wp\"][\"coreData\"];","module.exports = window[\"wp\"][\"data\"];","module.exports = window[\"wp\"][\"element\"];","module.exports = window[\"wp\"][\"i18n\"];","module.exports = window[\"wp\"][\"mediaUtils\"];","module.exports = window[\"wp\"][\"primitives\"];","module.exports = window[\"wp\"][\"url\"];","// packages/icons/src/library/chevron-down.tsx\nimport { Path, SVG } from \"@wordpress/primitives\";\nimport { jsx } from \"react/jsx-runtime\";\nvar chevron_down_default = /* @__PURE__ */ jsx(SVG, { viewBox: \"0 0 24 24\", xmlns: \"http://www.w3.org/2000/svg\", children: /* @__PURE__ */ jsx(Path, { d: \"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z\" }) });\nexport {\n  chevron_down_default as default\n};\n//# sourceMappingURL=chevron-down.mjs.map\n","// packages/icons/src/library/chevron-up.tsx\nimport { Path, SVG } from \"@wordpress/primitives\";\nimport { jsx } from \"react/jsx-runtime\";\nvar chevron_up_default = /* @__PURE__ */ jsx(SVG, { viewBox: \"0 0 24 24\", xmlns: \"http://www.w3.org/2000/svg\", children: /* @__PURE__ */ jsx(Path, { d: \"M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z\" }) });\nexport {\n  chevron_up_default as default\n};\n//# sourceMappingURL=chevron-up.mjs.map\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Check if module exists (development only)\n\tif (__webpack_modules__[moduleId] === undefined) {\n\t\tvar e = new Error(\"Cannot find module '\" + moduleId + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { createRoot } from '@wordpress/element';\nimport AttachmentDetails from './components/AttachmentDetails';\nimport './attachment-details.scss';\nimport {\n\tcaptureVideoFrame,\n\tgetVideoMetadata,\n\tcalculateTimecodes,\n} from '../../utils/video-capture';\nimport { createThumbnailFromCanvas, setPosterImage } from '../../utils/utils';\nimport { __, sprintf } from '@wordpress/i18n';\n\n// render on edit media screen\nconst editMediaContainer = document.getElementById(\n\t'videopack-attachment-details-root'\n);\n\nif (editMediaContainer) {\n\tconst urlParams = new URLSearchParams(window.location.search);\n\tconst postId = urlParams.get('post');\n\n\t// Create a new React root and render the component.\n\tconst videopackReactRoot = createRoot(editMediaContainer);\n\tvideopackReactRoot.render(<AttachmentDetails attachmentId={postId} />);\n}\n\n// Ensure wp.media is loaded.\nif (\n\ttypeof wp === 'undefined' ||\n\t!wp.media ||\n\t!wp.media.view ||\n\t!wp.media.view.Attachment.Details\n) {\n\tconsole.error(\n\t\t'Videopack: wp.media.view.Attachment.Details is not available.'\n\t);\n} else {\n\tconst originalAttachmentDetails = wp.media.view.Attachment.Details;\n\n\tconst extendedAttachmentDetails = originalAttachmentDetails.extend({\n\t\t// A reference to the React root instance.\n\t\tvideopackReactRoot: null,\n\n\t\tinitialize() {\n\t\t\t// Call the original initialize method.\n\t\t\toriginalAttachmentDetails.prototype.initialize.apply(\n\t\t\t\tthis,\n\t\t\t\targuments\n\t\t\t);\n\t\t\t// Listen for the 'ready' event, which is fired after the view is rendered.\n\t\t\tthis.on('ready', this.renderVideopackComponent, this);\n\t\t},\n\n\t\trenderVideopackComponent() {\n\t\t\t// Unmount any existing React component before re-rendering.\n\t\t\tif (this.videopackReactRoot) {\n\t\t\t\tthis.videopackReactRoot.unmount();\n\t\t\t\tthis.videopackReactRoot = null;\n\t\t\t}\n\n\t\t\t// Check if the attachment is a video.\n\t\t\tconst isVideo = this.model.attributes.type === 'video';\n\t\t\tconst isAnimatedGif =\n\t\t\t\tthis.model.attributes.subtype === 'gif' &&\n\t\t\t\tthis.model.attributes.meta?.['_kgvid-meta']?.animated;\n\n\t\t\tif (isVideo || isAnimatedGif) {\n\t\t\t\t// Find the .settings section in the attachment details sidebar.\n\t\t\t\t// Note: We use this.$el to scope the find to this view's element.\n\t\t\t\tlet settingsSection = this.$el.find('.settings');\n\t\t\t\tif (settingsSection.length === 0) {\n\t\t\t\t\tif (this.$el.hasClass('attachment-details')) {\n\t\t\t\t\t\tsettingsSection = this.$el;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (settingsSection.length === 0) {\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'Videopack: Could not find the .settings or .attachment-details section in the attachment details sidebar.'\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Create and append the root div for our React component.\n\t\t\t\tconst reactRootDiv = document.createElement('div');\n\t\t\t\treactRootDiv.id = 'videopack-attachment-details-root';\n\t\t\t\tsettingsSection.append(reactRootDiv);\n\n\t\t\t\t// Create a new React root and render the component.\n\t\t\t\tthis.videopackReactRoot = createRoot(reactRootDiv);\n\t\t\t\tthis.videopackReactRoot.render(\n\t\t\t\t\t<AttachmentDetails\n\t\t\t\t\t\tattachmentId={this.model.attributes.id}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\n\t\t// We also need to override remove to clean up our React root.\n\t\tremove() {\n\t\t\t// Unmount the React component when the view is removed.\n\t\t\tif (this.videopackReactRoot) {\n\t\t\t\tthis.videopackReactRoot.unmount();\n\t\t\t\tthis.videopackReactRoot = null;\n\t\t\t}\n\n\t\t\t// Call the original remove method.\n\t\t\treturn originalAttachmentDetails.prototype.remove.apply(\n\t\t\t\tthis,\n\t\t\t\targuments\n\t\t\t);\n\t\t},\n\t});\n\n\t// Replace the original view with our extended one.\n\twp.media.view.Attachment.Details = extendedAttachmentDetails;\n}\n\n// --- Auto-Generation Logic ---\n\ndocument.addEventListener('DOMContentLoaded', () => {\n\tif (typeof wp === 'undefined' || !wp.media) {\n\t\treturn;\n\t}\n\n\tconst config = window.videopack_config || {};\n\n\t// 1. Handle new uploads (hook into wp.media)\n\t// Only run if auto_thumb is enabled and FFmpeg is NOT handling it.\n\tif (config.auto_thumb && config.ffmpeg_exists !== true) {\n\t\tconst { media } = wp;\n\n\t\tif (\n\t\t\tmedia.model &&\n\t\t\tmedia.model.Attachments &&\n\t\t\tmedia.model.Attachments.prototype.add\n\t\t) {\n\t\t\tconst originalAdd = media.model.Attachments.prototype.add;\n\n\t\t\tmedia.model.Attachments.prototype.add = function (models, options) {\n\t\t\t\tconst added = originalAdd.apply(this, arguments);\n\n\t\t\t\tif (!added) {\n\t\t\t\t\treturn added;\n\t\t\t\t}\n\t\t\t\tconst newModels = Array.isArray(added) ? added : [added];\n\n\t\t\t\tnewModels.forEach((model) => {\n\t\t\t\t\t// Check if it's a video and currently uploading.\n\t\t\t\t\tif (\n\t\t\t\t\t\tmodel &&\n\t\t\t\t\t\ttypeof model.get === 'function' &&\n\t\t\t\t\t\tmodel.get('type') === 'video' &&\n\t\t\t\t\t\tmodel.get('uploading') === true\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst onUploadComplete = () => {\n\t\t\t\t\t\t\tif (model.get('uploading') === false) {\n\t\t\t\t\t\t\t\tmodel.off('change:uploading', onUploadComplete);\n\t\t\t\t\t\t\t\t// Small delay to ensure processing is done and URL is valid.\n\t\t\t\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\t\t\t\tprocessVideoItem(\n\t\t\t\t\t\t\t\t\t\t\tmodel.get('id'),\n\t\t\t\t\t\t\t\t\t\t\tmodel.get('url'),\n\t\t\t\t\t\t\t\t\t\t\tconfig,\n\t\t\t\t\t\t\t\t\t\t\tmodel\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t500\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tmodel.on('change:uploading', onUploadComplete);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn added;\n\t\t\t};\n\t\t}\n\t}\n\n\t// 2. Handle pending attachments (flagged from backend)\n\tif (config.pending_attachments && config.pending_attachments.length > 0) {\n\t\tprocessPendingAttachments(config.pending_attachments, config);\n\t}\n});\n\n/**\n * Processes a list of pending attachments.\n *\n * @param {Array}  attachments List of attachment objects {id, url}.\n * @param {Object} config      Plugin configuration.\n */\nasync function processPendingAttachments(attachments, config) {\n\tconst total = attachments.length;\n\tlet count = 0;\n\n\tconst notice = showNotice(\n\t\tsprintf(\n\t\t\t/* translators: %d: number of videos */\n\t\t\t__(\n\t\t\t\t'Generating thumbnails for %d videos',\n\t\t\t\t'video-embed-thumbnail-generator'\n\t\t\t),\n\t\t\ttotal\n\t\t)\n\t);\n\n\tfor (const att of attachments) {\n\t\ttry {\n\t\t\tawait processVideoItem(att.id, att.url, config);\n\t\t\tcount++;\n\t\t\tnotice.textContent = sprintf(\n\t\t\t\t/* translators: 1: current count, 2: total count */\n\t\t\t\t__(\n\t\t\t\t\t'Generating thumbnails: %1$d / %2$d',\n\t\t\t\t\t'video-embed-thumbnail-generator'\n\t\t\t\t),\n\t\t\t\tcount,\n\t\t\t\ttotal\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tconsole.error(\n\t\t\t\t'Videopack: Failed to process pending video',\n\t\t\t\tatt.id,\n\t\t\t\te\n\t\t\t);\n\t\t}\n\t}\n\n\tnotice.textContent = __(\n\t\t'Thumbnail generation complete.',\n\t\t'video-embed-thumbnail-generator'\n\t);\n\tsetTimeout(() => {\n\t\tif (notice.parentNode) {\n\t\t\tnotice.parentNode.removeChild(notice);\n\t\t}\n\t}, 3000);\n}\n\n/**\n * Generates thumbnails for a video.\n *\n * @param {number}                    id     The attachment ID.\n * @param {string}                    src    The video URL.\n * @param {Object}                    config The plugin configuration.\n * @param {wp.media.model.Attachment} model  Optional. The attachment model to update.\n */\nasync function processVideoItem(id, src, config, model = null) {\n\tconst totalThumbnails = Number(config.auto_thumb_number) || 1;\n\tconst position = Number(config.auto_thumb_position) || 50;\n\tconst watermarkOptions = config.ffmpeg_thumb_watermark;\n\n\ttry {\n\t\tconst video = await getVideoMetadata(src);\n\t\tconst duration = video.duration;\n\n\t\tif (!duration) {\n\t\t\tthrow new Error('Invalid duration');\n\t\t}\n\n\t\tconst timecodes = calculateTimecodes(duration, totalThumbnails, {\n\t\t\tposition,\n\t\t});\n\t\tconst generatedThumbs = [];\n\n\t\tfor (const time of timecodes) {\n\t\t\ttry {\n\t\t\t\tconst canvas = await captureVideoFrame(\n\t\t\t\t\tvideo,\n\t\t\t\t\ttime,\n\t\t\t\t\twatermarkOptions\n\t\t\t\t);\n\t\t\t\tconst response = await createThumbnailFromCanvas(\n\t\t\t\t\tcanvas,\n\t\t\t\t\tid,\n\t\t\t\t\tsrc\n\t\t\t\t);\n\t\t\t\tif (response && response.thumb_url) {\n\t\t\t\t\tgeneratedThumbs.push(response);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Videopack: Auto-thumbnail generation failed', e);\n\t\t\t}\n\t\t}\n\n\t\tif (generatedThumbs.length > 0) {\n\t\t\t// Determine which thumbnail should be the poster\n\t\t\tlet posterIndex = 0;\n\t\t\tif (totalThumbnails > 1) {\n\t\t\t\tposterIndex = position - 1;\n\t\t\t\tif (posterIndex < 0) {\n\t\t\t\t\tposterIndex = 0;\n\t\t\t\t}\n\t\t\t\tif (posterIndex >= totalThumbnails) {\n\t\t\t\t\tposterIndex = totalThumbnails - 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// The server automatically sets the last uploaded thumbnail as the featured image.\n\t\t\t// If the desired poster is NOT the last one, we must explicitly set it.\n\t\t\tif (posterIndex >= generatedThumbs.length) {\n\t\t\t\tposterIndex = generatedThumbs.length - 1;\n\t\t\t}\n\n\t\t\tif (posterIndex !== generatedThumbs.length - 1) {\n\t\t\t\tconst posterThumb = generatedThumbs[posterIndex];\n\t\t\t\ttry {\n\t\t\t\t\tawait setPosterImage(id, posterThumb.thumb_url);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Videopack: Failed to set poster', e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Update the model to reflect changes\n\t\t\tif (model) {\n\t\t\t\tawait model.fetch();\n\t\t\t}\n\t\t}\n\n\t\t// Cleanup\n\t\tvideo.src = '';\n\t\tvideo.load();\n\t} catch (e) {\n\t\tconsole.error('Videopack: Video processing failed', e);\n\t}\n}\n\n/**\n * Displays a fixed notification.\n *\n * @param {string} message The message to display.\n * @return {HTMLElement} The notice element.\n */\nfunction showNotice(message) {\n\tlet notice = document.getElementById('videopack-auto-gen-notice');\n\tif (!notice) {\n\t\tnotice = document.createElement('div');\n\t\tnotice.id = 'videopack-auto-gen-notice';\n\t\tnotice.style.cssText =\n\t\t\t'position: fixed; bottom: 20px; right: 20px; background: #fff; border-left: 4px solid #00a32a; box-shadow: 0 1px 1px 0 rgba(0,0,0,.1); padding: 10px 20px; z-index: 99999; font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif; font-size: 13px;';\n\t\tdocument.body.appendChild(notice);\n\t}\n\tnotice.textContent = message;\n\tnotice.style.display = 'block';\n\treturn notice;\n}\n"],"names":["__","sprintf","Button","PanelBody","PanelRow","Spinner","__experimentalConfirmDialog","ConfirmDialog","useRef","useEffect","useState","useSelect","store","coreStore","EncodeFormatStatus","getVideoFormats","enqueueJob","assignFormat","deleteFile","deleteJob","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AdditionalFormats","attributes","options","id","src","ffmpeg_exists","videoFormats","setVideoFormats","encodeMessage","setEncodeMessage","itemToDelete","setItemToDelete","deleteInProgress","setDeleteInProgress","isConfirmOpen","setIsConfirmOpen","isLoading","setIsLoading","isEncoding","setIsEncoding","progressTimerRef","updateVideoFormats","response","currentVideoFormats","newFormats","Object","keys","forEach","key","newFormat","oldFormat","checked","encoding_now","progress","percent","JSON","stringify","fetchVideoFormats","formats","error","console","pollVideoFormats","siteSettings","select","getSite","shouldPoll","values","some","format","status","incrementEncodeProgress","updatedVideoFormats","elapsed","Date","getTime","started","remaining","video_duration","totalDurationInSeconds","speedMatch","speed","String","match","parseFloat","increment","remainingPercent","Math","min","max","pollTimer","setInterval","current","clearInterval","handleFormatCheckbox","event","formatId","prevVideoFormats","updatedFormats","handleEnqueue","videopack_config","formatsToEncode","entries","filter","value","reduce","acc","queueMessage","queueList","encode_list","Array","isArray","length","Intl","ListFormat","language","replace","style","type","log","join","queuePosition","new_queue_position","errorMessage","data","details","message","onSelectFormat","media","handleFileDelete","formatData","handleJobDelete","jobId","openConfirmDialog","job_id","name","handleConfirm","handleCancel","somethingToEncode","obj","encodeButtonTitle","isEncodeButtonDisabled","confirmDialogMessage","canUploadFiles","canUser","groupedFormats","codec","codecId","push","sort","a","b","resolution","height","children","title","className","map","codecGroup","encode","enabled","format_id","ffmpegExists","onCheckboxChange","onDeleteFile","onCancelJob","isOpen","onConfirm","onCancel","variant","onClick","text","disabled","CheckboxControl","__experimentalDivider","Divider","MediaUpload","EncodeProgress","getCheckboxCheckedState","getCheckboxDisabledState","exists","__nextHasNoMarginBottom","label","onChange","status_l10n","was_picked","onSelect","allowedTypes","render","open","size","deletable","isBusy","isDestructive","convertToTimecode","time","undefined","isNaN","padZero","num","floor","toString","padStart","h","m","s","hh","mm","ss","round","percentText","width","fps","error_message","BaseControl","Dashicon","Icon","RangeControl","TextControl","useCallback","saveAllThumbnails","setPosterImage","generateThumbnail","createThumbnailFromCanvas","captureVideoFrame","calculateTimecodes","chevronUp","chevronDown","Thumbnails","setAttributes","videoData","poster","poster_id","isExternal","total_thumbnails","record","thumbVideoPanel","videoRef","posterImageButton","isPlaying","setIsPlaying","isOpened","setIsOpened","currentTime","setCurrentTime","thumbChoices","setThumbChoices","isSaving","setIsSaving","VIDEO_POSTER_ALLOWED_MEDIA_TYPES","window","mejs","players","mejsContainer","document","querySelector","mejsId","player","setPoster","onSelectPoster","image","url","Number","onRemovePoster","focus","handleGenerate","browserThumbnailsEnabled","browser_thumbnails","newThumbImages","i","generateThumb","thumb","real_thumb_url","generateThumbCanvases","thumbsInt","newThumbCanvases","timePoints","duration","random","canvas","ffmpeg_thumb_watermark","toDataURL","canvasObject","ffmpegError","togglePlayback","paused","play","pause","pauseVideo","playVideo","handleSliderChange","handleTimeUpdate","addEventListener","removeEventListener","handleSaveThumbnail","currentTarget","classList","add","setImgAsPoster","setCanvasAsPoster","handleSaveAllThumbnails","firstThumbType","uploadPromises","Promise","all","thumbUrls","setPosterData","thumb_url","thumb_id","new_poster","new_poster_id","metaData","meta","edit","featured_media","save","wp","frame","content","get","collection","props","set","ignore","library","handleVideoKeyboardControl","stopImmediatePropagation","code","playbackRate","preventDefault","handleUseThisFrame","handleToggleVideoPlayer","next","alt","VisualLabel","ref","index","icon","tabIndex","muted","preload","step","initialPosition","useEntityRecord","getSettings","AttachmentDetails","attachmentId","setOptions","attachment","then","hasResolved","combinedAttributes","source_url","media_details","sizes","full","apiFetch","addQueryArgs","getFilename","getQueue","path","toggleQueue","action","method","clearQueue","removeJob","mediaId","parentId","videoSrc","resolve","reject","toBlob","blob","Error","formData","FormData","append","uploadThumbnail","body","attachment_id","thumb_urls","getVideoGallery","args","getUsersWithCapability","capability","getFreemiusPage","page","getRecentVideos","posts","testFFmpegCommand","rotate","allSettings","videopack_options","saveWPSettings","newSettings","resetVideopackSettings","thumburl","thumbnail_index","generate_button","startBatchProcess","additionalData","getBatchProgress","getThumbnailCandidates","source","watermarkOptions","video","isTempVideo","createElement","crossOrigin","onSeeked","onError","videoWidth","videoHeight","ctx","getContext","drawImage","drawWatermark","e","load","onLoadedMetadata","seekTime","oneShotSeek","scale","align","x","valign","y","img","Image","onload","canvasWidth","canvasHeight","watermarkWidth","watermarkHeight","horizontalOffset","verticalOffset","xPos","yPos","onerror","getVideoMetadata","timeout","setTimeout","onloadedmetadata","clearTimeout","count","timecodes","position","randomOffset","createRoot","editMediaContainer","getElementById","urlParams","URLSearchParams","location","search","postId","videopackReactRoot","view","Attachment","Details","originalAttachmentDetails","extendedAttachmentDetails","extend","initialize","prototype","apply","arguments","on","renderVideopackComponent","unmount","isVideo","model","isAnimatedGif","subtype","animated","settingsSection","$el","find","hasClass","reactRootDiv","remove","config","auto_thumb","Attachments","originalAdd","models","added","newModels","onUploadComplete","off","processVideoItem","pending_attachments","processPendingAttachments","attachments","total","notice","showNotice","att","textContent","parentNode","removeChild","totalThumbnails","auto_thumb_number","auto_thumb_position","generatedThumbs","posterIndex","posterThumb","fetch","cssText","appendChild","display"],"sourceRoot":""}